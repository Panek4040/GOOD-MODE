{
  "title": "Dynamic Content Scraping with Waits and AJAX",
  "description": "Handle dynamically loaded content, AJAX requests, and infinite scroll",
  "difficulty": "advanced",
  "estimated_time": "60 minutes",
  "tools_used": [
    "selenium",
    "webdriverwait",
    "expected_conditions"
  ],
  "attack_chain": [
    {
      "step": 1,
      "title": "Setup with Headless Mode",
      "command": "from selenium.webdriver.chrome.options import Options; options = Options(); options.add_argument('--headless'); driver = webdriver.Chrome(options=options)",
      "explanation": "Initialize headless browser for background scraping",
      "expected_output": "Headless Chrome started",
      "success_criteria": "No GUI window"
    },
    {
      "step": 2,
      "title": "Navigate to Dynamic Page",
      "command": "driver.get('https://the-internet.herokuapp.com/dynamic_loading/2'); driver.find_element(By.CSS_SELECTOR, '#start button').click()",
      "explanation": "Load page with AJAX content and trigger loading",
      "expected_output": "Loading indicator appears",
      "success_criteria": "Content loading initiated"
    },
    {
      "step": 3,
      "title": "Wait for Dynamic Content",
      "command": "from selenium.webdriver.support.ui import WebDriverWait; from selenium.webdriver.support import expected_conditions as EC; wait = WebDriverWait(driver, 10); element = wait.until(EC.visibility_of_element_located((By.CSS_SELECTOR, '#finish h4'))); print(f'Loaded: {element.text}')",
      "explanation": "Explicit wait for AJAX content to appear",
      "expected_output": "Loaded: Hello World!",
      "success_criteria": "Dynamic content visible"
    },
    {
      "step": 4,
      "title": "Handle Infinite Scroll",
      "command": "driver.get('https://the-internet.herokuapp.com/infinite_scroll'); for i in range(5): driver.execute_script('window.scrollTo(0, document.body.scrollHeight);'); time.sleep(1); paragraphs = len(driver.find_elements(By.CLASS_NAME, 'jscroll-added')); print(f'Loaded {paragraphs} additional paragraphs')",
      "explanation": "Scroll to load more content dynamically",
      "expected_output": "Loaded 5 additional paragraphs",
      "success_criteria": "New content loaded"
    },
    {
      "step": 5,
      "title": "Wait for Element to be Clickable",
      "command": "driver.get('https://the-internet.herokuapp.com/dynamic_controls'); driver.find_element(By.XPATH, '//button[text()=\"Enable\"]').click(); wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, 'input[type=\"text\"]'))); print('Input field is now enabled')",
      "explanation": "Wait for button to enable input field",
      "expected_output": "Input field is now enabled",
      "success_criteria": "Element interactive"
    },
    {
      "step": 6,
      "title": "Handle Stale Elements",
      "command": "driver.get('https://the-internet.herokuapp.com/dynamic_controls'); checkbox = driver.find_element(By.CSS_SELECTOR, '#checkbox input'); driver.find_element(By.XPATH, '//button[text()=\"Remove\"]').click(); wait.until(EC.invisibility_of_element(checkbox)); print('Element removed from DOM')",
      "explanation": "Wait for element to become stale after removal",
      "expected_output": "Element removed from DOM",
      "success_criteria": "Staleness detected"
    },
    {
      "step": 7,
      "title": "Extract Table Data Dynamically",
      "command": "driver.get('https://the-internet.herokuapp.com/tables'); rows = driver.find_elements(By.CSS_SELECTOR, '#table1 tbody tr'); data = []; for row in rows: cols = row.find_elements(By.TAG_NAME, 'td'); data.append([col.text for col in cols]); print(f'Extracted {len(data)} rows')",
      "explanation": "Parse dynamic table data",
      "expected_output": "Extracted 4 rows",
      "success_criteria": "Table data captured"
    },
    {
      "step": 8,
      "title": "Wait for Text to Change",
      "command": "driver.get('https://the-internet.herokuapp.com/dynamic_loading/1'); driver.find_element(By.CSS_SELECTOR, '#start button').click(); wait.until(EC.text_to_be_present_in_element((By.CSS_SELECTOR, '#finish'), 'Hello')); print('Text appeared as expected')",
      "explanation": "Wait for specific text to appear in element",
      "expected_output": "Text appeared as expected",
      "success_criteria": "Text condition met"
    },
    {
      "step": 9,
      "title": "Handle AJAX Form Submission",
      "command": "driver.get('https://the-internet.herokuapp.com/notification_message_rendered'); driver.find_element(By.LINK_TEXT, 'Click here').click(); wait.until(EC.visibility_of_element_located((By.ID, 'flash'))); message = driver.find_element(By.ID, 'flash').text; print(f'Notification: {message}')",
      "explanation": "Capture dynamically rendered notification",
      "expected_output": "Notification: Action successful/unsuccesful",
      "success_criteria": "Flash message captured"
    },
    {
      "step": 10,
      "title": "Cleanup and Save Results",
      "command": "import json; results = {'total_pages': 3, 'elements_found': 42, 'status': 'completed'}; with open('/tmp/scraping_results.json', 'w') as f: json.dump(results, f); print('Results saved'); driver.quit()",
      "explanation": "Export scraped data and close browser",
      "expected_output": "Results saved",
      "success_criteria": "Data persisted"
    }
  ],
  "learning_objectives": [
    "Explicit waits",
    "Expected conditions",
    "AJAX handling",
    "Dynamic content",
    "Infinite scroll",
    "Stale element exceptions"
  ],
  "mitigation": [
    "Rate limiting",
    "CAPTCHA",
    "User-agent detection",
    "IP blocking"
  ],
  "tags": [
    "selenium",
    "scraping",
    "ajax",
    "dynamic_content",
    "waits"
  ]
}
