{
  "topic_id": "LNX_FS_FIND_LARGE_FILES",
  "title": "Investigate database storage growth",
  "goal": "Analyze which database files are consuming the most space and identify growth patterns",
  "steps": [
    {
      "thought": "First, let me check the overall size of the database directories",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "du",
        "args": ["-sh", "/var/lib/mysql", "/var/lib/postgresql"]
      },
      "observation": "45G\t/var/lib/mysql\n28G\t/var/lib/postgresql"
    },
    {
      "thought": "MySQL is using 45GB. Let me find the largest files in the MySQL data directory",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql -type f -printf '%s|%p|%TY-%Tm-%Td\\n' | sort -rn | head -n 20"]
      },
      "observation": "10737418240|/var/lib/mysql/ibdata1|2025-11-18\n5368709120|/var/lib/mysql/database1/large_table.ibd|2025-11-18\n2147483648|/var/lib/mysql/database1/users.ibd|2025-11-17\n1073741824|/var/lib/mysql/database1/transactions.ibd|2025-11-18\n858993459|/var/lib/mysql/database2/logs.ibd|2025-11-16\n536870912|/var/lib/mysql/database1/products.ibd|2025-11-15\n419430400|/var/lib/mysql/database2/analytics.ibd|2025-11-18\n314572800|/var/lib/mysql/mysql/innodb_index_stats.ibd|2025-11-14\n268435456|/var/lib/mysql/database1/orders.ibd|2025-11-18\n209715200|/var/lib/mysql/database2/events.ibd|2025-11-17"
    },
    {
      "thought": "ibdata1 is 10GB - the shared tablespace. Let me check which databases have the most data",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "for db in /var/lib/mysql/*/; do echo -n \"$(basename $db): \"; du -sh $db | awk '{print $1}'; done | sort -k2 -rh"]
      },
      "observation": "database1: 18G\ndatabase2: 8.5G\nmysql: 2.1G\nsys: 156M\nperformance_schema: 0"
    },
    {
      "thought": "database1 is 18GB. Let me find all .ibd files over 100MB in that database",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql/database1 -type f -name '*.ibd' -size +100M -printf '%s|%f|%TY-%Tm-%Td\\n' | sort -rn"]
      },
      "observation": "5368709120|large_table.ibd|2025-11-18\n2147483648|users.ibd|2025-11-17\n1073741824|transactions.ibd|2025-11-18\n536870912|products.ibd|2025-11-15\n268435456|orders.ibd|2025-11-18\n157286400|sessions.ibd|2025-11-16\n134217728|audit_log.ibd|2025-11-14"
    },
    {
      "thought": "Now let me check PostgreSQL to compare",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/postgresql -type f -printf '%s|%p\\n' | sort -rn | head -n 15"]
      },
      "observation": "3221225472|/var/lib/postgresql/14/main/base/16384/24601\n2147483648|/var/lib/postgresql/14/main/base/16384/24602\n1073741824|/var/lib/postgresql/14/main/base/16384/24603\n858993459|/var/lib/postgresql/14/main/base/16385/16389\n536870912|/var/lib/postgresql/14/main/base/16384/24604\n419430400|/var/lib/postgresql/14/main/base/16385/16390\n314572800|/var/lib/postgresql/14/main/pg_wal/000000010000000000000001\n268435456|/var/lib/postgresql/14/main/pg_wal/000000010000000000000002\n209715200|/var/lib/postgresql/14/main/base/16384/24605"
    },
    {
      "thought": "Let me check which files are growing by looking at modification times",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql -type f -name '*.ibd' -size +100M -mtime -7 -printf '%s|%p|%TY-%Tm-%Td\\n' | sort -rn"]
      },
      "observation": "5368709120|/var/lib/mysql/database1/large_table.ibd|2025-11-18\n2147483648|/var/lib/mysql/database1/users.ibd|2025-11-17\n1073741824|/var/lib/mysql/database1/transactions.ibd|2025-11-18\n536870912|/var/lib/mysql/database1/products.ibd|2025-11-15\n268435456|/var/lib/mysql/database1/orders.ibd|2025-11-18\n157286400|/var/lib/mysql/database1/sessions.ibd|2025-11-16\n134217728|/var/lib/mysql/database1/audit_log.ibd|2025-11-14"
    },
    {
      "thought": "All these files were modified in the last week. Let me group by database to see total usage",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql -type f -name '*.ibd' -size +100M -printf '%h|%s\\n' | awk -F'/' '{db=$(NF); size=$NF; gsub(/\\|.*/, \"\", db); gsub(/.*\\|/, \"\", size); sum[db]+=size; count[db]++} END {for (d in sum) printf \"%d|%d|%s\\n\", sum[d], count[d], d}' | sort -rn"]
      },
      "observation": "10066329600|7|database1\n4026531840|5|database2\n314572800|1|mysql"
    },
    {
      "thought": "Let me also check for any old binlog files that might be taking space",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql -type f -name 'mysql-bin.*' -size +50M -printf '%s|%p|%TY-%Tm-%Td\\n' | sort -rn"]
      },
      "observation": "524288000|/var/lib/mysql/mysql-bin.000089|2025-11-10\n419430400|/var/lib/mysql/mysql-bin.000088|2025-11-09\n314572800|/var/lib/mysql/mysql-bin.000087|2025-11-08\n268435456|/var/lib/mysql/mysql-bin.000086|2025-11-07\n209715200|/var/lib/mysql/mysql-bin.000085|2025-11-06"
    },
    {
      "thought": "Let me calculate total space used by old binlogs (older than 5 days)",
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "find /var/lib/mysql -type f -name 'mysql-bin.*' -mtime +5 -printf '%s\\n' | awk '{sum+=$1} END {print \"Total bytes: \"sum; print \"Total MB: \"sum/1024/1024}'"]
      },
      "observation": "Total bytes: 1736441856\nTotal MB: 1656"
    }
  ],
  "success_condition": "Analysis complete: MySQL uses 45GB total with database1 consuming 18GB (7 large tables totaling 10GB, led by large_table.ibd at 5GB). database2 uses 8.5GB (5 large tables totaling 4GB). Found 1.6GB of old binlog files that can be purged. PostgreSQL uses 28GB with largest table files at 3GB, 2GB, and 1GB."
}
