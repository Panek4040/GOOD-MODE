{
  "title": "Docker Container Escape and Host System Compromise",
  "description": "Container breakout from privileged Docker container to achieve host system root access. Demonstrates risks of misconfigured container deployments and Docker socket exposure.",
  "difficulty": "advanced",
  "scenario": "Cloud infrastructure penetration test. Initial access to containerized web application via RCE vulnerability. Container runs with elevated privileges. Goal: escape container isolation, compromise underlying host system, demonstrate lateral movement potential across container infrastructure.",
  "steps": [
    {
      "step_number": 1,
      "tool": "docker_container_escape",
      "action": "Confirm running inside Docker container",
      "parameters": {},
      "expected_result": "Found /proc/1/cgroup contains 'docker/', /.dockerenv file exists - confirmed Docker environment, container ID: a1b2c3d4e5f6",
      "explanation": "Identifying containerization is first step in planning escape strategy"
    },
    {
      "step_number": 2,
      "tool": "docker_container_escape",
      "action": "Check container capabilities and device access",
      "parameters": {},
      "expected_result": "Container has cap_sys_admin capability, can see host block devices /dev/sda, /dev/sdb - PRIVILEGED CONTAINER detected",
      "explanation": "Privileged containers have elevated capabilities enabling host filesystem mounting"
    },
    {
      "step_number": 3,
      "tool": "docker_container_escape",
      "action": "Mount host root filesystem from container",
      "parameters": {},
      "expected_result": "Successfully mounted /dev/sda1 to /tmp/host, can see host filesystem including /root, /etc, /home directories",
      "explanation": "cap_sys_admin allows mounting host devices, breaking container isolation"
    },
    {
      "step_number": 4,
      "tool": "docker_container_escape",
      "action": "Access and exfiltrate host sensitive data",
      "parameters": {},
      "expected_result": "Read host /etc/shadow with all password hashes, injected backdoor into /root/.bashrc, extracted SSH keys from /root/.ssh/",
      "explanation": "Full read/write access to host filesystem enables credential theft and persistence"
    },
    {
      "step_number": 5,
      "tool": "docker_container_escape",
      "action": "Chroot into host filesystem for complete host access",
      "parameters": {},
      "expected_result": "Executed chroot /tmp/host /bin/bash - now running as root on host system, hostname changed to 'host-server', can see dockerd process",
      "explanation": "Chroot pivots execution context to host, effectively escaping container"
    },
    {
      "step_number": 6,
      "tool": "docker_container_escape",
      "action": "Check for Docker socket exposure",
      "parameters": {},
      "expected_result": "Found /var/run/docker.sock accessible - Docker API socket exposed to container",
      "explanation": "Docker socket access allows spawning new privileged containers with host access"
    },
    {
      "step_number": 7,
      "tool": "docker_container_escape",
      "action": "Spawn new privileged container via Docker socket",
      "parameters": {},
      "expected_result": "Executed docker run -v /:/hostfs alpine chroot /hostfs sh - created new container with host filesystem mounted, achieved host root access",
      "explanation": "Docker socket abuse provides alternative escape path, demonstrates API security importance"
    },
    {
      "step_number": 8,
      "tool": "writable_path_exploitation",
      "action": "Establish persistent access on host via LD_PRELOAD backdoor",
      "parameters": {},
      "expected_result": "Compiled malicious shared library, configured LD_PRELOAD in host environment, persistent backdoor triggers on any privileged command execution",
      "explanation": "LD_PRELOAD persistence survives reboots and container restarts"
    }
  ],
  "outcome": "Complete container escape achieved through two vectors: privileged container capabilities and Docker socket exposure. Gained full root access to host system, extracted all credentials, established persistence. Compromised host controls entire container infrastructure - can access all containers, databases, application secrets. Recommendations: NEVER run containers in privileged mode in production, remove ALL Linux capabilities unless absolutely required, NEVER mount Docker socket into containers (/var/run/docker.sock), implement runtime security monitoring (Falco, Sysdig), use rootless containers, enable SELinux/AppArmor for container confinement, regularly audit container configurations, implement network segmentation between containers and host, use container security scanning in CI/CD.",
  "learning_objectives": [
    "Identify containerized environments from inside",
    "Detect privileged container configurations",
    "Exploit cap_sys_admin for host filesystem mounting",
    "Use chroot to escape container namespace",
    "Detect and exploit Docker socket exposure",
    "Abuse Docker API for container spawning",
    "Establish cross-container persistence mechanisms",
    "Provide container security hardening guidance"
  ],
  "metadata": {
    "created_by": "neural_mesh_v5.2_generator",
    "category": "pentesting",
    "subcategory": "container_escape",
    "tools_used": ["docker_container_escape", "writable_path_exploitation"],
    "estimated_time": "60-90 minutes",
    "authorization_required": true,
    "severity": "critical",
    "risk_level": "high"
  }
}
