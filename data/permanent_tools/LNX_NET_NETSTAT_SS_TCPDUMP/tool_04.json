{
  "name": "lsof_list_network_connections_files",
  "description": "List all open network sockets and files by process, user, or port using lsof",
  "pattern": "lsof.*network|open.*sockets|process.*connections|port.*usage",
  "parameters": [
    "filter_type",
    "filter_value"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "lsof -i -P -n | head -20"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "COMMAND    PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nsshd      1234 root    3u  IPv4  12345      0t0  TCP *:22 (LISTEN)\nnginx     5678 www     6u  IPv4  23456      0t0  TCP *:80 (LISTEN)\nmysqld    9012 mysql   10u IPv4  34567      0t0  TCP *:3306 (LISTEN)\nfirefox   3456 user    45u IPv4  45678      0t0  TCP 192.168.1.100:54321->203.0.113.45:443 (ESTABLISHED)"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "if [ '{{filter_type}}' = 'port' ]; then lsof -i :{{filter_value}} -P -n; elif [ '{{filter_type}}' = 'user' ]; then lsof -u {{filter_value}} -i -P -n; elif [ '{{filter_type}}' = 'process' ]; then lsof -c {{filter_value}} -i -P -n; elif [ '{{filter_type}}' = 'tcp' ]; then lsof -i TCP -P -n; elif [ '{{filter_type}}' = 'udp' ]; then lsof -i UDP -P -n; fi"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnginx   5678 www     6u  IPv4  23456      0t0  TCP *:{{filter_value}} (LISTEN)\nnginx   5679 www     6u  IPv4  23456      0t0  TCP *:{{filter_value}} (LISTEN)\nnginx   5680 www     45u IPv4  67890      0t0  TCP 192.168.1.100:{{filter_value}}->10.0.0.15:44332 (ESTABLISHED)"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "lsof -i -P -n | grep ESTABLISHED | wc -l"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "23"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "lsof -i -P -n | awk '{print $1}' | sort | uniq -c | sort -rn | head -10"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "     34 nginx\n     12 sshd\n      8 mysqld\n      6 firefox\n      4 chrome\n      3 python3"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
