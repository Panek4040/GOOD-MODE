{
  "name": "mitmproxy_intercept",
  "description": "Command-line HTTP/HTTPS proxy interception and modification using mitmproxy",
  "pattern": "mitmproxy|mitm.*proxy|mitmweb|mitmdump",
  "parameters": [
    "port",
    "target"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "mitmproxy",
        "args": [
          "-p",
          "8888",
          "--set",
          "console_eventlog_verbosity=debug"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Proxy server listening at http://127.0.0.1:8888\nmitmproxy v10.1.5\n\nPress ? for help\nPress q to quit\n\nFlows:\n[No flows yet]\n\nWaiting for HTTP/HTTPS traffic...\nConfigure client to use proxy: 127.0.0.1:8888"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "curl -x http://127.0.0.1:8888 http://testsite.com/api/users | head -20"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Request captured in mitmproxy:\n\n>> GET http://testsite.com/api/users\n   Host: testsite.com\n   User-Agent: curl/7.68.0\n   Accept: */*\n\n<< 200 OK 1.2k\n   Content-Type: application/json\n   Content-Length: 1247\n\nmitmproxy interface shows:\n  - Flow list with request/response\n  - Press Enter to view details\n  - Press e to edit request before forwarding\n  - Press r to replay request"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "mitmweb",
        "args": [
          "--web-port",
          "8081",
          "-p",
          "8888"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Web interface started at http://127.0.0.1:8081\nmitmweb proxy listening on 127.0.0.1:8888\n\nBrowser-based interface available:\n  URL: http://127.0.0.1:8081\n  Features:\n    - Visual flow inspection\n    - Request/response editing\n    - Replay functionality\n    - Export to curl/httpie\n    - Filter and search flows\n\nCapturing traffic through 127.0.0.1:8888"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "mitmdump",
        "args": [
          "-p",
          "8888",
          "-w",
          "traffic.dump",
          "--set",
          "flow_detail=3"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "mitmdump: Proxy server listening at http://127.0.0.1:8888\nSaving flows to: traffic.dump\n\nCaptured flows:\n  127.0.0.1:54321 → testsite.com:80\n    GET http://testsite.com/ HTTP/1.1\n    << 200 OK 3.4k text/html\n\n  127.0.0.1:54322 → api.testsite.com:443\n    POST https://api.testsite.com/login HTTP/1.1\n      {\"username\":\"admin\",\"password\":\"test123\"}\n    << 200 OK 0.5k application/json\n      {\"token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"}\n\n  127.0.0.1:54323 → testsite.com:80\n    GET http://testsite.com/api/users?id=1 HTTP/1.1\n    << 200 OK 1.2k application/json\n\nAll traffic saved to traffic.dump for offline analysis"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "cat > modify_request.py << 'EOF'\nfrom mitmproxy import http\n\ndef request(flow: http.HTTPFlow) -> None:\n    if 'api.testsite.com' in flow.request.pretty_url:\n        flow.request.headers['X-Admin'] = 'true'\n        if flow.request.urlencoded_form:\n            flow.request.urlencoded_form['username'] = 'admin'\nEOF\n&& mitmproxy -s modify_request.py -p 8888"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "mitmproxy started with script: modify_request.py\nProxy listening on 127.0.0.1:8888\n\nScript loaded - automatic request modification active:\n\nOriginal request:\n  POST https://api.testsite.com/login\n  username=user&password=test\n\nModified request:\n  POST https://api.testsite.com/login\n  X-Admin: true\n  username=admin&password=test\n\nAll requests to api.testsite.com automatically:\n  - Add X-Admin: true header\n  - Change username parameter to 'admin'\n\nScript-based modification enables automated testing"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "mitmdump -p 8888 -w - | grep -E 'POST|password'"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "mitmdump filtering POST requests with passwords:\n\n  POST https://testsite.com/login HTTP/1.1\n    password=test123\n  << 401 Unauthorized\n\n  POST https://testsite.com/login HTTP/1.1\n    password=admin123\n  << 200 OK\n    Set-Cookie: session=abc123xyz\n\n  POST https://api.testsite.com/reset-password HTTP/1.1\n    old_password=admin123&new_password=newpass456\n  << 200 OK\n\nFiltered output shows only authentication-related traffic\nUseful for credential harvesting and session tracking"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
