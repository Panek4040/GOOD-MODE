{
  "name": "vbox_snapshot_create_restore_delete",
  "description": "Create VM snapshots, list existing snapshots, restore to snapshot, delete old snapshots",
  "pattern": "create.*snapshot|restore.*snapshot|vm.*checkpoint|snapshot.*list",
  "parameters": ["vm_name", "snapshot_name", "operation"],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "VBoxManage",
        "args": ["snapshot", "{{vm_name}}", "list", "--machinereadable"]
      },
      "expected_output": {
        "type": "string",
        "example": "SnapshotName=\"Clean Install\"\nSnapshotUUID=\"1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d\"\nSnapshotName-1=\"After Updates\"\nSnapshotUUID-1=\"2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e\""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "if [ '{{operation}}' = 'create' ]; then VBoxManage snapshot '{{vm_name}}' take '{{snapshot_name}}' --description 'Created at $(date)'; elif [ '{{operation}}' = 'restore' ]; then VBoxManage snapshot '{{vm_name}}' restore '{{snapshot_name}}'; elif [ '{{operation}}' = 'delete' ]; then VBoxManage snapshot '{{vm_name}}' delete '{{snapshot_name}}'; fi"]
      },
      "expected_output": {
        "type": "string",
        "example": "0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\nSnapshot taken. UUID: 3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "VBoxManage",
        "args": ["snapshot", "{{vm_name}}", "list"]
      },
      "expected_output": {
        "type": "string",
        "example": "Name: Clean Install (UUID: 1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d)\n   Name: After Updates (UUID: 2b3c4d5e-6f7a-8b9c-0d1e-2f3a4b5c6d7e) *\n      Name: {{snapshot_name}} (UUID: 3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f)"
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "VBoxManage showvminfo '{{vm_name}}' --machinereadable | grep -E 'Snapshot|CurrentSnapshot'"]
      },
      "expected_output": {
        "type": "string",
        "example": "SnapshotCount=\"3\"\nCurrentSnapshotName=\"{{snapshot_name}}\"\nCurrentSnapshotUUID=\"3c4d5e6f-7a8b-9c0d-1e2f-3a4b5c6d7e8f\""
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
