{
  "name": "vbox_clone_vm_full_linked",
  "description": "Clone existing VM as full or linked clone with new MAC addresses and UUID",
  "pattern": "clone.*virtual.*machine|duplicate.*vm|copy.*vbox",
  "parameters": ["source_vm", "clone_name", "clone_mode"],
  "sequence": [
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "VBoxManage",
        "args": ["showvminfo", "{{source_vm}}", "--machinereadable"]
      },
      "expected_output": {
        "type": "string",
        "example": "name=\"{{source_vm}}\"\nmemory=4096\ncpus=2\nVMState=\"poweroff\"\nhardwareuuid=\"5fbaabe4-6b24-4b8c-9d3a-7c8e9f1a2b3c\""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "if [ '{{clone_mode}}' = 'full' ]; then VBoxManage clonevm '{{source_vm}}' --name '{{clone_name}}' --mode all --options link --register; else VBoxManage clonevm '{{source_vm}}' --name '{{clone_name}}' --snapshot 'Current' --options link --register; fi"]
      },
      "expected_output": {
        "type": "string",
        "example": "0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\nMachine has been successfully cloned as \"{{clone_name}}\""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "VBoxManage modifyvm '{{clone_name}}' --macaddress1 auto"]
      },
      "expected_output": {
        "type": "string",
        "example": ""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "VBoxManage",
        "args": ["showvminfo", "{{clone_name}}", "--machinereadable"]
      },
      "expected_output": {
        "type": "string",
        "example": "name=\"{{clone_name}}\"\nmemory=4096\ncpus=2\nVMState=\"poweroff\"\nhardwareuuid=\"9d8e7f6a-5b4c-3d2e-1f0a-9b8c7d6e5f4a\"\nmacaddress1=\"080027ABC123\""
      }
    },
    {
      "action": {
        "type": "system_command",
        "tool": "shell",
        "operation": "run",
        "command": "bash",
        "args": ["-c", "du -sh \"$HOME/VirtualBox VMs/{{clone_name}}\""]
      },
      "expected_output": {
        "type": "string",
        "example": "12G\t/home/user/VirtualBox VMs/{{clone_name}}"
      }
    }
  ],
  "stats": {
    "uses": 0,
    "successes": 0,
    "failures": 0,
    "success_rate": 0.0
  },
  "created_by": "neural_mesh_v5.2_generator"
}
